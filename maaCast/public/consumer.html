<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>MaaCast</title>
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/consumer.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/session.js" type="text/javascript"></script>
    
</head>
<body>
    <div ng-app="consumer" class="container-fluid" ng-controller="container" ng-strict-di>
    <div class="row" >
        <div class="col-md-12" >
            <nav class="navbar navbar-expand-lg navbar-light bg-light static-top navbar-dark bg-dark">
                 
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="navbar-toggler-icon"></span>
                </button> <img src="img/brand.png"/>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="navbar-nav">
                        <li class="nav-item active">
                             <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <!--li class="nav-item active">
                             <a ng-click="getRestaurants()" class="nav-link" href="#">Restaurants</a>
                        </li>
                        <li class="nav-item active">
                             <a class="nav-link" href="#">Food</a>
                        </li-->
                    </ul>
                    <form class="form-inline">
                        <input class="form-control mr-sm-2" type="text" ng-model="inputCity" placeholder="Enter your location"/>
                        <button ng-click="findRestaurants(inputCity)" type="button" class="btn btn-danger">Find restaurants</button>
                    </form>
                    <ul class="navbar-nav ml-md-auto">
                        <li class="nav-item active dropdown">
                             <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown"><strong>{{username}}</strong></a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                 <a class="dropdown-item" href="/edit-profile.html">Edit profile</a> <a class="dropdown-item" href="/order-status.html">Your orders</a> <a class="dropdown-item" href="#">Manage addresses</a> 
                                <div class="dropdown-divider">
                                </div> <a class="dropdown-item" onclick="logout()" href="#">Logout</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="carousel slide" id="carousel-566386" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-slide-to="0" data-target="#carousel-566386" class="active">
                    </li>
                    <li data-slide-to="1" data-target="#carousel-566386">
                    </li>
                    <li data-slide-to="2" data-target="#carousel-566386">
                    </li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img class="d-block w-100" alt="Carousel Bootstrap First" src="img/food1.jpg" />
                        <div class="carousel-caption">
                            <h2>
                                Good food gives us good mood
                            </h2>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" alt="Carousel Bootstrap Second" src="img/food2.jpg" />
                        <div class="carousel-caption">
                            <h2>
                                Nothing Brings people together like good food
                            </h2>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" alt="Carousel Bootstrap Third" src="img/food3.jpg" />
                        <div class="carousel-caption">
                            <h2>
                                Keep calm and eat sweets
                            </h2>
                        </div>
                    </div>
                </div> <a class="carousel-control-prev" href="#carousel-566386" data-slide="prev"><span class="carousel-control-prev-icon"></span> <span class="sr-only">Previous</span></a> <a class="carousel-control-next" href="#carousel-566386" data-slide="next"><span class="carousel-control-next-icon"></span> <span class="sr-only">Next</span></a>
            </div>

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="jumbotron bg-dark text-white">
                <h2>
                    Hello, {{username}}
                </h2>
                <p>
                    Enter the location name and click on find restaurants, it lists all the restaurants and home-food(freelancers) centers.
                </p>
                <p>
                    <form class="form-inline">
                        <input class="form-control mr-sm-2" type="text" ng-model="inputCity" placeholder="Enter your location name"/> 
                        <button ng-click="findRestaurants(inputCity)" type="button" class="btn btn-warning">Find restaurants</button>
                    </form>
                </p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2">
            <table ng-show="showFilter" class="table borderless bg-light" style='margin-top: 3vh;'>
                <tr class="text-dark">
                    <th>Filters</th>
                </tr>
                <tr>
                    <td><input type="text" ng-model="searchRestaurant" placeholder="Search for restaurant"></td>
                </tr>
                <tr>
                    <td><a href="#" class="text-dark" ng-click="sortBy('restaurantName')">Sort by name</a></td>
                </tr>
            </table>
        </div>
        <div class="col-md-4">
            <div class="row bg-light" style="background-color: lightgrey;margin-top:3vh;" ng-repeat="item in restaurants | filter: searchRestaurant | orderBy: sort">
                <div class="col-md-4">
                    <img class="rounded" src="img/Restaurant.jpg" width="150" height="150">
                </div>
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-12">
                        <a href="#" ng-click="findfood(item)" class="text-danger"><h4><strong>{{item.restaurantName}}</strong></h4></a>
                        </div>
                        <div class="col-md-12" style="font-size: 14px;">
                            
                            <strong>{{item.Address.city}}</strong><br>
                             {{item.Address.flatNumber+" "+item.Address.street}}
                             {{item.Address.pincode+" "+item.contactNumber}} 
                             
                        </div>
                        <div class="col-md-12">
                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div ng-include="'footer.html'"></div>
</div>
<script>
        
var consumerApp = angular.module('consumer',[]); 
consumerApp.controller('container', ['$scope', function($scope) {

  var session;
   var user;
   checkSession();
   user=JSON.parse(localStorage.getItem('user'));

    $scope.username=user.firstName+" "+user.lastName;
    //console.log(sessionStorage.getItem('user'));
    localStorage.removeItem('restaurant');

    $scope.sortBy=function(type)
    {
        $scope.sort=type;
    }
   // alert(sessionStorage.getItem('username'));
    $scope.findRestaurants = function(inputCity) {
        checkSession();
         //$scope.spice = 'very';
        //alert("clicked");
        $scope.showFilter=true;
        data={"city":inputCity}
        
        var restaurants=[];
        console.log(data);
        $.ajax(
        {
            url: "/restaurant/list",
            type: "POST",
            contentType : "application/json",
            data:JSON.stringify(data),
            async:false,
            success: function (response){
                //console.log(response);
                restaurants=response.obj;
                localStorage.setItem('allRestaurants',JSON.stringify(restaurants));
                //console.log(JSON.parse(sessionStorage.getItem("restaurant"))[0].menu);
            },
            error: function (response){
                console.log(response);
            }
        });
       //console.log(data[0].restaurantName);

       $scope.restaurants=restaurants;//sessionStorage.getItem('restaurant');

         
    };

       $scope.findfood=function(restaurant)
       {
        checkSession();
            localStorage.setItem('restaurant',JSON.stringify(restaurant));
           // alert(JSON.stringify(restaurant));
            window.location.href="/food.html";
        };

}]);

    </script>
</body>